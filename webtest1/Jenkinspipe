@Library("webtestlib") _
pipeline{
parameters {
  choice choices: ['main', 'develop', 'qatest'], description: 'choose a branch to build', name: 'SelectBranch'
  }
    agent{label "slave-linux"}
    stages{
        stage("main"){
            when {
                       expression {
                                     params.SelectBranch == 'main'
                                 }
                                 
                 }
                 steps{
                         git branch:'main', credentialsId: 'github-creds', url: 'https://github.com/greeshmagit/webtest1.git' 
                         echo "deployed main branch job"
                      }
            
          }
              stage("develop") {
                when {
                          expression {
                                      params.SelectBranch == 'develop'
                                    }
                          
                     }
    
                    steps{
                              git branch:'develop', credentialsId: 'github-creds', url: 'https://github.com/greeshmagit/webtest1.git' 
                              echo "deployed develop branch job"
                         }
                 }
                  stage("qatest") {
                    when {
                               expression {
                                            params.SelectBranch == 'qatest'
                                         }
                             
                         }
        
                        steps{
                                git branch:'qatest', credentialsId: 'github-creds', url: 'https://github.com/greeshmagit/webtest1.git' 
                                  echo "deployed qatest branch job"
                             }
                    
                      }
                stage("Maven package"){
                steps{
                         sh 'mvn -f webtest1/pom.xml clean package'
                     }
              }
              stage("Docker build"){
                  steps{
                           sh "docker build -t pgreeshma/webtest app : v1 ."
                        }
               }
             /*stage("nexus artifact"){
                  steps{
                      script{
                         def mavenPom = readMavenPom file:'webtest1/pom.xml'
                         def nexusRepoName = mavenPom.version.endsWith("SNAPSHOT") ? "mvn-web-snapshot" : "mvn-web-nex"
                         nexusArtifactUploader artifacts: [[artifactId: 'webtest', classifier: '', file: 'webtest1/target/webtest.war', type: 'war']],
                         credentialsId: 'nexus',
                         groupId: 'com.greeshma',
                         nexusUrl: '172.31.15.210:8081', 
                         nexusVersion: 'nexus3', 
                         protocol: 'http',
                         repository: nexusRepoName, 
                         version: mavenPom.version
                       }
                   }
                }
               stage("deploy"){
                  steps{
                          tomcatdeploy('ec2-user','172.31.1.31','tomcat')
                     }
              }*/
       
       }
   }
       
  
                      
